secrets:
  builder.crt.v3:
    external: true
  builder.key.v1:
    external: true
services:
  builder:
    deploy:
      endpoint_mode: dnsrr
      mode: global
      placement:
        constraints:
        - node.labels.builder == true
    environment:
      AGENT_HOST: null
      AGENT_PORT: null
      DEBUG: null
      PREFERRED_IP_VERSION: null
    extra_hosts:
      etcd: 178.128.144.222
    hostname: '{{.Node.ID}}-{{.Service.Name}}'
    image: electronuserland/build-service-builder@sha256:0c496a789ec2e8dcadca32f5c4bea36ca06f52dfa2ab5baadb145d6b75819884
    logging:
      driver: json-file
      options:
        max-file: '2'
        max-size: 4m
    ports:
    - mode: host
      published: 443
      target: 443
    secrets:
    - source: builder.crt.v3
      target: /etc/secrets/tls.cert
    - source: builder.key.v1
      target: /etc/secrets/tls.key
    volumes:
    - target: /builder-tmp
      type: tmpfs
  etcd-cluster-client:
    command:
    - --name=etcd
    - --advertise-client-urls=http://etcd:2379
    - --listen-client-urls=http://0.0.0.0:2379
    deploy:
      endpoint_mode: dnsrr
      mode: global
      placement:
        constraints:
        - node.labels.admin == true
    entrypoint: /usr/local/bin/etcd
    image: gcr.io/etcd-development/etcd@sha256:87921b377d5696461975582fc8a4d2ed0b7991ad82afbc4cbe68ef383ff6c295
    ports:
    - mode: host
      published: 2379
      target: 2379
  router:
    deploy:
      endpoint_mode: dnsrr
      placement:
        constraints:
        - node.labels.admin == true
    hostname: '{{.Node.ID}}-{{.Service.Name}}'
    image: electronuserland/build-service-router@sha256:d13b0bf57273997534c2116b74f5df2e92d74fa637566e26eed1a90803c031d6
    logging:
      driver: json-file
      options:
        max-file: '2'
        max-size: 4m
    ports:
    - mode: host
      published: 443
      target: 443
    secrets:
    - source: builder.crt.v3
      target: /etc/secrets/tls.cert
    - source: builder.key.v1
      target: /etc/secrets/tls.key
version: '3.4'

